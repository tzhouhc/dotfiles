#!/bin/bash

set -e

secret-store() {
    name=$(gum input --placeholder "Secret name (e.g., openai-api-key)")

    if [ -z "$name" ]; then
        gum style --foreground 196 "Error: Secret name cannot be empty"
        return 1
    fi

    gum style --foreground 212 "Enter your secret (input will be hidden):"
    secret=$(gum input --password --placeholder "Enter secret value")

    if [ -z "$secret" ]; then
        gum style --foreground 196 "Error: Secret cannot be empty"
        return 1
    fi

    echo "$secret" | age -p | base64 | gh gist create --filename "${name}.age" > /tmp/gist_url.txt

    gist_url=$(cat /tmp/gist_url.txt)
    gist_id=$(echo "$gist_url" | rev | cut -d'/' -f1 | rev)

    gum style \
        --foreground 212 --border-foreground 212 --border double \
        --align center --width 100 --margin "1 2" --padding "1 2" \
        "Secret stored successfully!" "" \
        "Gist ID: $gist_id" "" \
        "URL: $gist_url"

    rm /tmp/gist_url.txt
}

secret-store "$@"
